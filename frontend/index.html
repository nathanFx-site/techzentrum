<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tech Zentrale | Elektronik und Technik</title>
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-storage-compat.js"></script>
    <!-- Stripe.js -->
    <script src="https://js.stripe.com/v3/"></script>
    <!-- Font Awesome for icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --red: #d42e2e;
            --blue: #1e3c9d;
            --white: #ffffff;
            --light-gray: #f5f5f5;
            --dark-gray: #333333;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Arial', sans-serif;
        }
        
        body {
            color: var(--dark-gray);
            line-height: 1.6;
            background-color: var(--white);
        }
        
        .gradient-bg {
            background: linear-gradient(135deg, var(--red) 0%, var(--blue) 50%, var(--white) 100%);
            color: white;
        }
        
        .container {
            width: 90%;
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 15px;
        }
        
        /* Header Styles */
        header {
            padding: 1rem 0;
            background-color: rgba(0, 0, 0, 0.8);
            position: fixed;
            width: 100%;
            z-index: 1000;
            top: 0;
            left: 0;
            transition: transform 0.3s ease;
        }
        
        .header-container {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .logo {
            font-size: 1.8rem;
            font-weight: bold;
            color: white;
        }
        
        .logo span {
            color: var(--red);
        }
        
        nav ul {
            display: flex;
            list-style: none;
        }
        
        nav ul li {
            margin-left: 1.5rem;
        }
        
        nav ul li a {
            color: white;
            text-decoration: none;
            font-weight: 500;
            transition: color 0.3s;
        }
        
        nav ul li a:hover {
            color: var(--red);
        }
        
        /* Auth Buttons */
        .auth-buttons {
            display: flex;
            gap: 10px;
            align-items: center;
        }
        
        .auth-btn {
            padding: 8px 15px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-weight: bold;
            transition: background-color 0.3s;
        }
        
        .login-btn {
            background-color: transparent;
            border: 2px solid var(--red);
            color: var(--red);
        }
        
        .login-btn:hover {
            background-color: var(--red);
            color: white;
        }
        
        .signup-btn {
            background-color: var(--red);
            color: white;
            border: 2px solid var(--red);
        }
        
        .signup-btn:hover {
            background-color: #b02525;
            border-color: #b02525;
        }
        
        .wishlist-btn, .cart-btn {
            background: none;
            border: none;
            color: white;
            font-size: 1.2rem;
            cursor: pointer;
            margin-left: 15px;
            position: relative;
        }
        
        .wishlist-count, .cart-count {
            position: absolute;
            top: -8px;
            right: -8px;
            background-color: var(--red);
            color: white;
            border-radius: 50%;
            width: 18px;
            height: 18px;
            font-size: 0.7rem;
            display: flex;
            justify-content: center;
            align-items: center;
        }
        
        /* Hero Section */
        .hero {
            height: 100vh;
            display: flex;
            align-items: center;
            padding-top: 80px;
            background: url('https://images.unsplash.com/photo-1498049794561-7780e7231661?ixlib=rb-4.0.3&auto=format&fit=crop&w=1674&q=80') no-repeat center center/cover;
            position: relative;
        }
        
        .hero::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, rgba(212, 46, 46, 0.7) 0%, rgba(30, 60, 157, 0.7) 50%, rgba(255, 255, 255, 0.7) 100%);
        }
        
        .hero-content {
            position: relative;
            z-index: 1;
            max-width: 600px;
        }
        
        .hero h1 {
            font-size: 3.5rem;
            margin-bottom: 1rem;
            color: white;
        }
        
        .hero p {
            font-size: 1.2rem;
            margin-bottom: 2rem;
            color: white;
        }
        
        .btn {
            display: inline-block;
            padding: 0.8rem 1.8rem;
            background-color: var(--red);
            color: white;
            text-decoration: none;
            border-radius: 4px;
            font-weight: bold;
            transition: background-color 0.3s;
            border: none;
            cursor: pointer;
        }
        
        .btn:hover {
            background-color: #b02525;
        }
        
        .btn-outline {
            background-color: transparent;
            border: 2px solid white;
            margin-left: 1rem;
        }
        
        .btn-outline:hover {
            background-color: white;
            color: var(--blue);
        }
        
        /* Search and Filter */
        .search-filter {
            background-color: var(--light-gray);
            padding: 1.5rem;
            border-radius: 8px;
            margin: 2rem 0;
        }
        
        .filter-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 1rem;
        }
        
        .filter-group {
            margin-bottom: 1rem;
        }
        
        .filter-group label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: bold;
        }
        
        .filter-group select,
        .filter-group input {
            width: 100%;
            padding: 0.8rem;
            border: 1px solid #ddd;
            border-radius: 4px;
        }
        
        /* Product Grid */
        .section-title {
            text-align: center;
            margin: 3rem 0;
            font-size: 2.2rem;
        }
        
        .section-title::after {
            content: '';
            display: block;
            width: 80px;
            height: 4px;
            background: linear-gradient(to right, var(--red), var(--blue));
            margin: 0.5rem auto;
        }
        
        .products-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 2rem;
            margin-bottom: 3rem;
        }
        
        .product-card {
            background-color: white;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            transition: transform 0.3s;
            position: relative;
        }
        
        .product-card:hover {
            transform: translateY(-5px);
        }
        
        .product-image {
            height: 200px;
            background-color: #ddd;
            background-position: center;
            background-size: cover;
        }
        
        .product-details {
            padding: 1.5rem;
        }
        
        .product-title {
            font-size: 1.3rem;
            margin-bottom: 0.5rem;
        }
        
        .product-price {
            font-size: 1.5rem;
            color: var(--red);
            font-weight: bold;
            margin-bottom: 1rem;
        }
        
        .product-specs {
            display: flex;
            justify-content: space-between;
            margin-bottom: 1rem;
            font-size: 0.9rem;
            color: #666;
        }
        
        .wishlist-icon, .cart-icon {
            position: absolute;
            top: 10px;
            background: rgba(255, 255, 255, 0.8);
            border-radius: 50%;
            width: 40px;
            height: 40px;
            display: flex;
            justify-content: center;
            align-items: center;
            cursor: pointer;
            font-size: 1.2rem;
            color: #ccc;
            transition: color 0.3s;
        }
        
        .wishlist-icon {
            right: 60px;
        }
        
        .cart-icon {
            right: 10px;
        }
        
        .wishlist-icon.active, .cart-icon.active {
            color: var(--red);
        }
        
        .wishlist-icon:hover, .cart-icon:hover {
            color: var(--red);
        }
        
        /* Product Detail Page */
        .product-detail {
            padding: 100px 0;
        }
        
        .detail-container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 3rem;
        }
        
        .product-gallery {
            position: relative;
        }
        
        .main-image {
            height: 400px;
            background-color: #ddd;
            background-position: center;
            background-size: cover;
            border-radius: 8px;
            margin-bottom: 1rem;
        }
        
        .thumbnail-container {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 1rem;
        }
        
        .thumbnail {
            height: 80px;
            background-color: #ddd;
            background-position: center;
            background-size: cover;
            border-radius: 4px;
            cursor: pointer;
        }
        
        .product-info h1 {
            font-size: 2.5rem;
            margin-bottom: 1rem;
            color: var(--dark-gray);
        }
        
        .product-info .price {
            font-size: 2rem;
            color: var(--red);
            font-weight: bold;
            margin-bottom: 1.5rem;
        }
        
        .specs-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1rem;
            margin-bottom: 2rem;
        }
        
        .spec-item {
            display: flex;
            justify-content: space-between;
            padding: 0.8rem 0;
            border-bottom: 1px solid #eee;
        }
        
        /* Cart Page */
        .cart-page {
            padding: 100px 0;
        }
        
        .cart-items {
            margin-bottom: 2rem;
        }
        
        .cart-item {
            display: grid;
            grid-template-columns: 100px 1fr auto auto auto;
            gap: 1rem;
            align-items: center;
            padding: 1rem;
            border-bottom: 1px solid #eee;
        }
        
        .cart-item-image {
            width: 100px;
            height: 100px;
            background-size: cover;
            background-position: center;
            border-radius: 4px;
        }
        
        .cart-summary {
            background-color: var(--light-gray);
            padding: 1.5rem;
            border-radius: 8px;
        }
        
        .summary-item {
            display: flex;
            justify-content: space-between;
            margin-bottom: 1rem;
        }
        
        .summary-total {
            font-size: 1.2rem;
            font-weight: bold;
            border-top: 2px solid #ddd;
            padding-top: 1rem;
            margin-top: 1rem;
        }
        
        /* Checkout Page */
        .checkout-page {
            padding: 100px 0;
        }
        
        .checkout-container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 3rem;
        }
        
        .checkout-form {
            background-color: white;
            padding: 1.5rem;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }
        
        /* Admin Panel */
        .admin-panel {
            display: none;
            padding: 2rem;
            background-color: var(--light-gray);
            border-radius: 8px;
            margin: 2rem 0;
        }
        
        .admin-controls {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 2rem;
        }
        
        .admin-form {
            background-color: white;
            padding: 1.5rem;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }
        
        .form-group {
            margin-bottom: 1rem;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: bold;
        }
        
        .form-group input,
        .form-group textarea,
        .form-group select {
            width: 100%;
            padding: 0.8rem;
            border: 1px solid #ddd;
            border-radius: 4px;
        }
        
        .image-upload {
            border: 2px dashed #ccc;
            padding: 1rem;
            text-align: center;
            margin-bottom: 1rem;
            cursor: pointer;
        }
        
        .image-upload:hover {
            border-color: var(--blue);
        }
        
        /* Auth Modals */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.7);
            z-index: 1001;
            justify-content: center;
            align-items: center;
        }
        
        .modal-content {
            background-color: white;
            padding: 2rem;
            border-radius: 8px;
            width: 90%;
            max-width: 400px;
        }
        
        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
        }
        
        .close-modal {
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
        }
        
        /* Wishlist Page */
        .wishlist-page {
            padding: 100px 0;
        }
        
        /* Footer */
        footer {
            background-color: var(--dark-gray);
            color: white;
            padding: 3rem 0 1rem;
        }
        
        .footer-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 2rem;
            margin-bottom: 2rem;
        }
        
        .footer-column h3 {
            font-size: 1.2rem;
            margin-bottom: 1.5rem;
            position: relative;
            padding-bottom: 0.5rem;
        }
        
        .footer-column h3::after {
            content: '';
            position: absolute;
            left: 0;
            bottom: 0;
            width: 40px;
            height: 3px;
            background: linear-gradient(to right, var(--red), var(--blue));
        }
        
        .footer-column ul {
            list-style: none;
        }
        
        .footer-column ul li {
            margin-bottom: 0.8rem;
        }
        
        .footer-column ul li a {
            color: #ccc;
            text-decoration: none;
            transition: color 0.3s;
        }
        
        .footer-column ul li a:hover {
            color: var(--red);
        }
        
        .social-links {
            display: flex;
            gap: 1rem;
            margin-top: 1rem;
        }
        
        .social-links a {
            display: flex;
            justify-content: center;
            align-items: center;
            width: 40px;
            height: 40px;
            background-color: #444;
            border-radius: 50%;
            color: white;
            text-decoration: none;
            transition: background-color 0.3s;
        }
        
        .social-links a:hover {
            background-color: var(--red);
        }
        
        .copyright {
            text-align: center;
            padding-top: 2rem;
            border-top: 1px solid #444;
            font-size: 0.9rem;
            color: #999;
        }
        
        /* Responsive Design */
        @media (max-width: 768px) {
            .header-container {
                flex-direction: column;
                gap: 1rem;
            }
            
            nav ul {
                flex-wrap: wrap;
                justify-content: center;
            }
            
            nav ul li {
                margin: 0.5rem;
            }
            
            .hero h1 {
                font-size: 2.5rem;
            }
            
            .admin-controls {
                grid-template-columns: 1fr;
            }
            
            .detail-container {
                grid-template-columns: 1fr;
            }
            
            .filter-grid {
                grid-template-columns: 1fr;
            }
            
            .checkout-container {
                grid-template-columns: 1fr;
            }
            
            .cart-item {
                grid-template-columns: 1fr;
                text-align: center;
            }
        }

        /* Loading Spinner */
        .spinner {
            border: 4px solid rgba(0, 0, 0, 0.1);
            border-left-color: var(--red);
            border-radius: 50%;
            width: 30px;
            height: 30px;
            animation: spin 1s linear infinite;
            margin: 20px auto;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* Error Message */
        .error-message {
            background-color: #ffebee;
            color: #c62828;
            padding: 10px;
            border-radius: 4px;
            margin: 10px 0;
            text-align: center;
        }

        /* Success Message */
        .success-message {
            background-color: #e8f5e9;
            color: #2e7d32;
            padding: 10px;
            border-radius: 4px;
            margin: 10px 0;
            text-align: center;
        }
    </style>
</head>
<body>
    <!-- Header -->
    <header>
        <div class="container header-container">
            <div class="logo">Tech <span>Zentrale</span></div>
            <nav>
                <ul>
                    <li><a href="#" class="nav-link" data-section="home">Startseite</a></li>
                    <li><a href="#" class="nav-link" data-section="products">Produkte</a></li>
                    <li><a href="#" class="nav-link" data-section="about">Über uns</a></li>
                    <li><a href="#" class="nav-link" data-section="contact">Kontakt</a></li>
                    <li><a href="#" class="nav-link" data-section="admin" id="admin-link" style="display: none;">Admin</a></li>
                </ul>
            </nav>
            <div class="auth-buttons">
                <button class="auth-btn login-btn" id="login-btn">Anmelden</button>
                <button class="auth-btn signup-btn" id="signup-btn">Registrieren</button>
                <button class="auth-btn login-btn" id="logout-btn" style="display: none;">Abmelden</button>
                <button class="wishlist-btn" id="header-wishlist" style="display: none;">
                    <i class="fas fa-heart"></i>
                    <span class="wishlist-count">0</span>
                </button>
                <button class="cart-btn" id="header-cart">
                    <i class="fas fa-shopping-cart"></i>
                    <span class="cart-count">0</span>
                </button>
            </div>
        </div>
    </header>

    <!-- Main Content Sections -->
    <main>
        <!-- Home Section -->
        <section id="home-section">
            <div class="hero">
                <div class="container hero-content">
                    <h1>Willkommen bei Tech Zentrale</h1>
                    <p>Ihr Partner für Elektronik und Technik. Entdecken Sie unsere Auswahl an Laptops, Smartphones und elektronischen Geräten.</p>
                    <div>
                        <a href="#" class="btn" id="browse-btn">Produkte entdecken</a>
                        <a href="#" class="btn btn-outline" id="learn-more-btn">Mehr erfahren</a>
                    </div>
                </div>
            </div>

            <!-- Featured Products -->
            <div class="container">
                <h2 class="section-title">Empfohlene Produkte</h2>
                <div class="products-grid" id="featured-products">
                    <!-- Products will be loaded dynamically -->
                </div>
            </div>
        </section>

        <!-- Products Section -->
        <section id="products-section" style="display: none; padding: 100px 0;">
            <div class="container">
                <h2 class="section-title">Unsere Produkte</h2>
                
                <!-- Search and Filter -->
                <div class="search-filter">
                    <div class="filter-grid">
                        <div class="filter-group">
                            <label for="search-category">Kategorie</label>
                            <select id="search-category">
                                <option value="">Alle Kategorien</option>
                                <option value="Laptop">Laptops</option>
                                <option value="Smartphone">Smartphones</option>
                                <option value="Tablet">Tablets</option>
                                <option value="Zubehör">Zubehör</option>
                            </select>
                        </div>
                        <div class="filter-group">
                            <label for="search-brand">Marke</label>
                            <select id="search-brand">
                                <option value="">Alle Marken</option>
                                <!-- Options will be populated dynamically -->
                            </select>
                        </div>
                        <div class="filter-group">
                            <label for="search-price">Preisbereich</label>
                            <div style="display: flex; gap: 10px;">
                                <input type="number" id="search-price-min" placeholder="Min" min="0">
                                <input type="number" id="search-price-max" placeholder="Max" min="0">
                            </div>
                        </div>
                    </div>
                    <button class="btn" style="margin-top: 1rem;" id="apply-filters">Filter anwenden</button>
                    <button class="btn btn-outline" style="margin-top: 1rem; margin-left: 1rem;" id="reset-filters">Filter zurücksetzen</button>
                </div>
                
                <div class="products-grid" id="products-grid">
                    <!-- Products will be loaded dynamically -->
                </div>
            </div>
        </section>

        <!-- Product Detail Section -->
        <section id="product-detail-section" style="display: none; padding: 100px 0;">
            <div class="container product-detail">
                <div class="detail-container">
                    <div class="product-gallery">
                        <div class="main-image" id="detail-main-image"></div>
                        <div class="thumbnail-container" id="detail-thumbnails">
                            <!-- Thumbnails will be loaded dynamically -->
                        </div>
                    </div>
                    <div class="product-info">
                        <h1 id="detail-title"></h1>
                        <div class="price" id="detail-price"></div>
                        <div class="specs-grid">
                            <div class="spec-item">
                                <span>Kategorie:</span>
                                <span id="detail-category"></span>
                            </div>
                            <div class="spec-item">
                                <span>Marke:</span>
                                <span id="detail-brand"></span>
                            </div>
                            <div class="spec-item">
                                <span>Modell:</span>
                                <span id="detail-model"></span>
                            </div>
                            <div class="spec-item">
                                <span>Zustand:</span>
                                <span id="detail-condition"></span>
                            </div>
                            <div class="spec-item">
                                <span>Garantie:</span>
                                <span id="detail-warranty"></span>
                            </div>
                        </div>
                        <p id="detail-description"></p>
                        <div style="margin-top: 2rem;">
                            <button class="btn" id="detail-cart-btn">In den Warenkorb</button>
                            <button class="btn btn-outline" style="margin-left: 1rem;" id="detail-wishlist-btn">Zur Wunschliste</button>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- About Us Section -->
        <section id="about-section" style="display: none; padding: 100px 0;">
            <div class="container">
                <h2 class="section-title">Über Tech Zentrale</h2>
                <div style="max-width: 800px; margin: 0 auto;">
                    <p style="margin-bottom: 1.5rem;">Tech Zentrale wurde 2018 mit der Leidenschaft für Technologie gegründet. Was als kleiner Laden begann, hat sich zu einem der angesehensten Elektronikgeschäfte des Landes entwickelt.</p>
                    
                    <p style="margin-bottom: 1.5rem;">Wir legen Wert auf jedes Produkt, das durch unsere Türen geht, und stellen sicher, dass jedes unseren strengen Qualitäts- und Authentizitätsstandards entspricht.</p>
                    
                    <p style="margin-bottom: 1.5rem;">Egal, ob Sie ein erfahrener Technik-Enthusiast sind oder Ihr erstes elektronisches Gerät kaufen, wir sind hier, um Ihr Erlebnis angenehm und lohnenswert zu gestalten. Unser kompetentes Personal begleitet Sie durch jeden Schritt des Prozesses, von der Auswahl bis zur Finanzierung und darüber hinaus.</p>
                    
                    <h3 style="margin: 2rem 0 1rem; color: var(--red);">Unsere Mission</h3>
                    <p>Enthusiasten mit den Technikprodukten ihrer Träume zu verbinden und gleichzeitig technisches Know-how für zukünftige Generationen zu bewahren.</p>
                </div>
            </div>
        </section>

        <!-- Contact Section -->
        <section id="contact-section" style="display: none; padding: 100px 0;">
            <div class="container">
                <h2 class="section-title">Kontakt</h2>
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 3rem;">
                    <div>
                        <h3 style="margin-bottom: 1.5rem; color: var(--red);">Kontaktieren Sie uns</h3>
                        <form id="contact-form">
                            <div class="form-group">
                                <label for="name">Ihr Name</label>
                                <input type="text" id="name" required>
                            </div>
                            <div class="form-group">
                                <label for="email">E-Mail Adresse</label>
                                <input type="email" id="email" required>
                            </div>
                            <div class="form-group">
                                <label for="message">Nachricht</label>
                                <textarea id="message" rows="5" required></textarea>
                            </div>
                            <button type="submit" class="btn">Nachricht senden</button>
                        </form>
                    </div>
                    <div>
                        <h3 style="margin-bottom: 1.5rem; color: var(--red);">Besuchen Sie uns</h3>
                        <div style="margin-bottom: 2rem;">
                            <p><strong>Adresse:</strong> Musterstraße 123, Berlin</p>
                            <p><a href="tel:+493012345678"><i class="fas fa-phone"></i> +49 30 12345678</a></p>
                            <p><a href="mailto:info@techzentrale.de"><i class="fas fa-envelope"></i> info@techzentrale.de</a></p>
                        </div>
                        
                        <h3 style="margin-bottom: 1rem; color: var(--red);">Öffnungszeiten</h3>
                        <div style="margin-bottom: 2rem;">
                            <p>Montag-Freitag: 9:00 - 18:00 Uhr</p>
                            <p>Samstag: 10:00 - 16:00 Uhr</p>
                            <p>Sonntag: Geschlossen</p>
                        </div>
                        
                        <div id="map" style="height: 200px; background-color: #ddd; display: flex; justify-content: center; align-items: center;">
                            <!-- In a real implementation, you would embed a Google Map here -->
                            <p>Karte würde hier angezeigt</p>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Wishlist Section -->
        <section id="wishlist-section" style="display: none; padding: 100px 0;">
            <div class="container wishlist-page">
                <h2 class="section-title">Meine Wunschliste</h2>
                <div class="products-grid" id="wishlist-products">
                    <!-- Wishlist products will be loaded dynamically -->
                </div>
                <div id="empty-wishlist" style="text-align: center; display: none;">
                    <p>Ihre Wunschliste ist leer. Fügen Sie Produkte hinzu, die Sie interessieren!</p>
                    <a href="#" class="btn" style="margin-top: 1rem;" id="browse-wishlist-btn">Produkte durchsuchen</a>
                </div>
            </div>
        </section>

        <!-- Cart Section -->
        <section id="cart-section" style="display: none; padding: 100px 0;">
            <div class="container cart-page">
                <h2 class="section-title">Warenkorb</h2>
                <div class="cart-items" id="cart-items">
                    <!-- Cart items will be loaded dynamically -->
                </div>
                <div class="cart-summary">
                    <div class="summary-item">
                        <span>Zwischensumme:</span>
                        <span id="cart-subtotal">0,00 €</span>
                    </div>
                    <div class="summary-item">
                        <span>Versand:</span>
                        <span id="cart-shipping">0,00 €</span>
                    </div>
                    <div class="summary-item summary-total">
                        <span>Gesamtsumme:</span>
                        <span id="cart-total">0,00 €</span>
                    </div>
                    <button class="btn" style="width: 100%; margin-top: 1rem;" id="checkout-btn">Zur Kasse</button>
                </div>
            </div>
        </section>

        <!-- Checkout Section -->
        <section id="checkout-section" style="display: none; padding: 100px 0;">
            <div class="container checkout-page">
                <h2 class="section-title">Kasse</h2>
                <div class="checkout-container">
                    <div class="checkout-form">
                        <h3 style="margin-bottom: 1.5rem; color: var(--red);">Versandinformationen</h3>
                        <form id="checkout-form">
                            <div class="form-group">
                                <label for="checkout-name">Vollständiger Name</label>
                                <input type="text" id="checkout-name" required>
                            </div>
                            <div class="form-group">
                                <label for="checkout-email">E-Mail Adresse</label>
                                <input type="email" id="checkout-email" required>
                            </div>
                            <div class="form-group">
                                <label for="checkout-address">Adresse</label>
                                <input type="text" id="checkout-address" required>
                            </div>
                            <div class="form-group">
                                <label for="checkout-city">Stadt</label>
                                <input type="text" id="checkout-city" required>
                            </div>
                            <div class="form-group">
                                <label for="checkout-zip">Postleitzahl</label>
                                <input type="text" id="checkout-zip" required>
                            </div>
                            <div class="form-group">
                                <label for="checkout-country">Land</label>
                                <select id="checkout-country" required>
                                    <option value="Deutschland">Deutschland</option>
                                    <option value="Österreich">Österreich</option>
                                    <option value="Schweiz">Schweiz</option>
                                </select>
                            </div>
                            <button type="submit" class="btn" style="width: 100%;" id="checkout-submit-btn">Weiter zur Zahlung</button>
                            <div id="checkout-loading" class="spinner" style="display: none;"></div>
                            <div id="checkout-error" class="error-message" style="display: none;"></div>
                        </form>
                    </div>
                    <div class="cart-summary">
                        <h3 style="margin-bottom: 1.5rem; color: var(--red);">Bestellübersicht</h3>
                        <div id="checkout-items">
                            <!-- Checkout items will be loaded dynamically -->
                        </div>
                        <div class="summary-item">
                            <span>Zwischensumme:</span>
                            <span id="checkout-subtotal">0,00 €</span>
                        </div>
                        <div class="summary-item">
                            <span>Versand:</span>
                            <span id="checkout-shipping">0,00 €</span>
                        </div>
                        <div class="summary-item summary-total">
                            <span>Gesamtsumme:</span>
                            <span id="checkout-total">0,00 €</span>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Admin Section -->
        <section id="admin-section" style="display: none; padding: 100px 0;">
            <div class="container">
                <h2 class="section-title">Admin-Bereich</h2>
                <div class="admin-controls">
                    <div class="admin-form">
                        <h3 style="margin-bottom: 1.5rem; color: var(--red);">Produkt hinzufügen</h3>
                        <form id="add-product-form">
                            <div class="form-group">
                                <label for="product-name">Produktname</label>
                                <input type="text" id="product-name" required>
                            </div>
                            <div class="form-group">
                                <label for="product-description">Beschreibung</label>
                                <textarea id="product-description" rows="3" required></textarea>
                            </div>
                            <div class="form-group">
                                <label for="product-price">Preis (€)</label>
                                <input type="number" id="product-price" min="0" step="0.01" required>
                            </div>
                            <div class="form-group">
                                <label for="product-category">Kategorie</label>
                                <select id="product-category" required>
                                    <option value="">Bitte wählen</option>
                                    <option value="Laptop">Laptop</option>
                                    <option value="Smartphone">Smartphone</option>
                                    <option value="Tablet">Tablet</option>
                                    <option value="Zubehör">Zubehör</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="product-brand">Marke</label>
                                <input type="text" id="product-brand" required>
                            </div>
                            <div class="form-group">
                                <label for="product-model">Modell</label>
                                <input type="text" id="product-model" required>
                            </div>
                            <div class="form-group">
                                <label for="product-condition">Zustand</label>
                                <select id="product-condition" required>
                                    <option value="">Bitte wählen</option>
                                    <option value="Neu">Neu</option>
                                    <option value="Gebraucht">Gebraucht</option>
                                    <option value="Refurbished">Refurbished</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="product-warranty">Garantie</label>
                                <input type="text" id="product-warranty" required>
                            </div>
                            <div class="form-group">
                                <label>Bilder</label>
                                <div class="image-upload" id="image-upload-area">
                                    <i class="fas fa-cloud-upload-alt" style="font-size: 2rem; margin-bottom: 1rem;"></i>
                                    <p>Klicken Sie hier, um Bilder hochzuladen</p>
                                    <input type="file" id="product-images" multiple accept="image/*" style="display: none;">
                                </div>
                                <div id="image-preview"></div>
                            </div>
                            <button type="submit" class="btn">Produkt hinzufügen</button>
                            <div id="add-product-loading" class="spinner" style="display: none;"></div>
                            <div id="add-product-message" style="display: none;"></div>
                        </form>
                    </div>
                    <div class="admin-form">
                        <h3 style="margin-bottom: 1.5rem; color: var(--red);">Produkte verwalten</h3>
                        <div id="admin-products-list">
                            <!-- Products will be loaded dynamically -->
                        </div>
                    </div>
                </div>
            </div>
        </section>
    </main>

    <!-- Footer -->
    <footer>
        <div class="container">
            <div class="footer-grid">
                <div class="footer-column">
                    <h3>Tech Zentrale</h3>
                    <p>Ihr zuverlässiger Partner für Elektronik und Technik. Wir bieten qualitativ hochwertige Produkte zu fairen Preisen.</p>
                    <div class="social-links">
                        <a href="#"><i class="fab fa-facebook-f"></i></a>
                        <a href="#"><i class="fab fa-twitter"></i></a>
                        <a href="#"><i class="fab fa-instagram"></i></a>
                        <a href="#"><i class="fab fa-linkedin-in"></i></a>
                    </div>
                </div>
                <div class="footer-column">
                    <h3>Kategorien</h3>
                    <ul>
                        <li><a href="#">Laptops</a></li>
                        <li><a href="#">Smartphones</a></li>
                        <li><a href="#">Tablets</a></li>
                        <li><a href="#">Zubehör</a></li>
                    </ul>
                </div>
                <div class="footer-column">
                    <h3>Kundenservice</h3>
                    <ul>
                        <li><a href="#">Kontakt</a></li>
                        <li><a href="#">Versandinformationen</a></li>
                        <li><a href="#">Rückgabe & Umtausch</a></li>
                        <li><a href="#">Häufige Fragen</a></li>
                    </ul>
                </div>
                <div class="footer-column">
                    <h3>Kontakt</h3>
                    <ul>
                        <li><i class="fas fa-map-marker-alt"></i> Musterstraße 123, Berlin</li>
                        <li><i class="fas fa-phone"></i> +49 30 12345678</li>
                        <li><i class="fas fa-envelope"></i> info@techzentrale.de</li>
                    </ul>
                </div>
            </div>
            <div class="copyright">
                <p>&copy; 2023 Tech Zentrale. Alle Rechte vorbehalten.</p>
            </div>
        </div>
    </footer>

    <!-- Auth Modals -->
    <div class="modal" id="login-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Anmelden</h2>
                <button class="close-modal">&times;</button>
            </div>
            <form id="login-form">
                <div class="form-group">
                    <label for="login-email">E-Mail</label>
                    <input type="email" id="login-email" required>
                </div>
                <div class="form-group">
                    <label for="login-password">Passwort</label>
                    <input type="password" id="login-password" required>
                </div>
                <button type="submit" class="btn">Anmelden</button>
                <div id="login-loading" class="spinner" style="display: none;"></div>
                <div id="login-error" class="error-message" style="display: none;"></div>
            </form>
        </div>
    </div>

    <div class="modal" id="signup-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Registrieren</h2>
                <button class="close-modal">&times;</button>
            </div>
            <form id="signup-form">
                <div class="form-group">
                    <label for="signup-name">Name</label>
                    <input type="text" id="signup-name" required>
                </div>
                <div class="form-group">
                    <label for="signup-email">E-Mail</label>
                    <input type="email" id="signup-email" required>
                </div>
                <div class="form-group">
                    <label for="signup-password">Passwort</label>
                    <input type="password" id="signup-password" required>
                </div>
                <div class="form-group">
                    <label for="signup-confirm">Passwort bestätigen</label>
                    <input type="password" id="signup-confirm" required>
                </div>
                <button type="submit" class="btn">Registrieren</button>
                <div id="signup-loading" class="spinner" style="display: none;"></div>
                <div id="signup-error" class="error-message" style="display: none;"></div>
            </form>
        </div>
    </div>

    <!-- Firebase and Stripe Configuration -->
    <script>
        // Firebase configuration
        const firebaseConfig = {
            apiKey: "YOUR_API_KEY",
            authDomain: "tech-zentrale.firebaseapp.com",
            projectId: "tech-zentrale",
            storageBucket: "tech-zentrale.appspot.com",
            messagingSenderId: "YOUR_MESSAGING_SENDER_ID",
            appId: "YOUR_APP_ID"
        };

        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();
        const auth = firebase.auth();
        const storage = firebase.storage();

        // Initialize Stripe
        const stripe = Stripe('YOUR_STRIPE_PUBLISHABLE_KEY');

        // Global state
        let currentUser = null;
        let products = [];
        let cart = [];
        let wishlist = [];
        let brands = [];

        // DOM Elements
        const elements = {
            // Navigation
            navLinks: document.querySelectorAll('.nav-link'),
            loginBtn: document.getElementById('login-btn'),
            signupBtn: document.getElementById('signup-btn'),
            logoutBtn: document.getElementById('logout-btn'),
            headerWishlist: document.getElementById('header-wishlist'),
            headerCart: document.getElementById('header-cart'),
            adminLink: document.getElementById('admin-link'),
            
            // Sections
            sections: {
                home: document.getElementById('home-section'),
                products: document.getElementById('products-section'),
                productDetail: document.getElementById('product-detail-section'),
                about: document.getElementById('about-section'),
                contact: document.getElementById('contact-section'),
                wishlist: document.getElementById('wishlist-section'),
                cart: document.getElementById('cart-section'),
                checkout: document.getElementById('checkout-section'),
                admin: document.getElementById('admin-section')
            },
            
            // Auth Modals
            loginModal: document.getElementById('login-modal'),
            signupModal: document.getElementById('signup-modal'),
            closeModalBtns: document.querySelectorAll('.close-modal'),
            
            // Product Lists
            featuredProducts: document.getElementById('featured-products'),
            productsGrid: document.getElementById('products-grid'),
            wishlistProducts: document.getElementById('wishlist-products'),
            adminProductsList: document.getElementById('admin-products-list'),
            emptyWishlist: document.getElementById('empty-wishlist'),
            
            // Product Detail
            detailMainImage: document.getElementById('detail-main-image'),
            detailThumbnails: document.getElementById('detail-thumbnails'),
            detailTitle: document.getElementById('detail-title'),
            detailPrice: document.getElementById('detail-price'),
            detailCategory: document.getElementById('detail-category'),
            detailBrand: document.getElementById('detail-brand'),
            detailModel: document.getElementById('detail-model'),
            detailCondition: document.getElementById('detail-condition'),
            detailWarranty: document.getElementById('detail-warranty'),
            detailDescription: document.getElementById('detail-description'),
            detailCartBtn: document.getElementById('detail-cart-btn'),
            detailWishlistBtn: document.getElementById('detail-wishlist-btn'),
            
            // Cart
            cartItems: document.getElementById('cart-items'),
            cartSubtotal: document.getElementById('cart-subtotal'),
            cartShipping: document.getElementById('cart-shipping'),
            cartTotal: document.getElementById('cart-total'),
            checkoutBtn: document.getElementById('checkout-btn'),
            
            // Checkout
            checkoutItems: document.getElementById('checkout-items'),
            checkoutSubtotal: document.getElementById('checkout-subtotal'),
            checkoutShipping: document.getElementById('checkout-shipping'),
            checkoutTotal: document.getElementById('checkout-total'),
            checkoutForm: document.getElementById('checkout-form'),
            checkoutSubmitBtn: document.getElementById('checkout-submit-btn'),
            checkoutLoading: document.getElementById('checkout-loading'),
            checkoutError: document.getElementById('checkout-error'),
            
            // Filters
            searchCategory: document.getElementById('search-category'),
            searchBrand: document.getElementById('search-brand'),
            searchPriceMin: document.getElementById('search-price-min'),
            searchPriceMax: document.getElementById('search-price-max'),
            applyFilters: document.getElementById('apply-filters'),
            resetFilters: document.getElementById('reset-filters'),
            
            // Admin
            addProductForm: document.getElementById('add-product-form'),
            imageUploadArea: document.getElementById('image-upload-area'),
            productImages: document.getElementById('product-images'),
            imagePreview: document.getElementById('image-preview'),
            addProductLoading: document.getElementById('add-product-loading'),
            addProductMessage: document.getElementById('add-product-message'),
            
            // Auth Forms
            loginForm: document.getElementById('login-form'),
            loginLoading: document.getElementById('login-loading'),
            loginError: document.getElementById('login-error'),
            signupForm: document.getElementById('signup-form'),
            signupLoading: document.getElementById('signup-loading'),
            signupError: document.getElementById('signup-error'),
            
            // Contact Form
            contactForm: document.getElementById('contact-form')
        };

        // Initialize the application
        function init() {
            // Set up event listeners
            setupEventListeners();
            
            // Load products from Firestore
            loadProducts();
            
            // Check if user is logged in
            checkAuthState();
            
            // Load cart and wishlist from localStorage
            loadLocalStorage();
            
            // Update cart and wishlist counts
            updateHeaderCounts();
        }

        // Set up event listeners
        function setupEventListeners() {
            // Navigation
            elements.navLinks.forEach(link => {
                link.addEventListener('click', (e) => {
                    e.preventDefault();
                    const section = e.target.getAttribute('data-section');
                    showSection(section);
                });
            });
            
            // Auth buttons
            elements.loginBtn.addEventListener('click', () => showModal('login'));
            elements.signupBtn.addEventListener('click', () => showModal('signup'));
            elements.logoutBtn.addEventListener('click', handleLogout);
            elements.headerWishlist.addEventListener('click', () => showSection('wishlist'));
            elements.headerCart.addEventListener('click', () => showSection('cart'));
            
            // Modal close buttons
            elements.closeModalBtns.forEach(btn => {
                btn.addEventListener('click', () => {
                    elements.loginModal.style.display = 'none';
                    elements.signupModal.style.display = 'none';
                });
            });
            
            // Click outside modal to close
            window.addEventListener('click', (e) => {
                if (e.target === elements.loginModal) {
                    elements.loginModal.style.display = 'none';
                }
                if (e.target === elements.signupModal) {
                    elements.signupModal.style.display = 'none';
                }
            });
            
            // Auth forms
            elements.loginForm.addEventListener('submit', handleLogin);
            elements.signupForm.addEventListener('submit', handleSignup);
            
            // Filters
            elements.applyFilters.addEventListener('click', applyFilters);
            elements.resetFilters.addEventListener('click', resetFilters);
            
            // Checkout
            elements.checkoutBtn.addEventListener('click', () => showSection('checkout'));
            elements.checkoutForm.addEventListener('submit', handleCheckout);
            
            // Admin
            elements.imageUploadArea.addEventListener('click', () => elements.productImages.click());
            elements.productImages.addEventListener('change', handleImageUpload);
            elements.addProductForm.addEventListener('submit', handleAddProduct);
            
            // Contact form
            elements.contactForm.addEventListener('submit', handleContact);
            
            // Browse buttons
            document.getElementById('browse-btn').addEventListener('click', (e) => {
                e.preventDefault();
                showSection('products');
            });
            
            document.getElementById('learn-more-btn').addEventListener('click', (e) => {
                e.preventDefault();
                showSection('about');
            });
            
            document.getElementById('browse-wishlist-btn').addEventListener('click', (e) => {
                e.preventDefault();
                showSection('products');
            });
        }

        // Show a specific section
        function showSection(section) {
            // Hide all sections
            Object.values(elements.sections).forEach(sec => {
                sec.style.display = 'none';
            });
            
            // Show the requested section
            if (elements.sections[section]) {
                elements.sections[section].style.display = 'block';
                
                // Special handling for certain sections
                if (section === 'products') {
                    renderProducts(products);
                } else if (section === 'wishlist') {
                    renderWishlist();
                } else if (section === 'cart') {
                    renderCart();
                } else if (section === 'checkout') {
                    renderCheckout();
                } else if (section === 'admin') {
                    renderAdminProducts();
                }
            }
        }

        // Show a modal
        function showModal(modal) {
            if (modal === 'login') {
                elements.loginModal.style.display = 'flex';
                elements.signupModal.style.display = 'none';
            } else if (modal === 'signup') {
                elements.signupModal.style.display = 'none';
                elements.loginModal.style.display = 'flex';
            }
        }

        // Load products from Firestore
        function loadProducts() {
            db.collection('products').get()
                .then((querySnapshot) => {
                    products = [];
                    brands = [];
                    
                    querySnapshot.forEach((doc) => {
                        const product = {
                            id: doc.id,
                            ...doc.data()
                        };
                        products.push(product);
                        
                        // Collect unique brands
                        if (product.brand && !brands.includes(product.brand)) {
                            brands.push(product.brand);
                        }
                    });
                    
                    // Render products
                    renderProducts(products);
                    renderFeaturedProducts();
                    
                    // Populate brand filter
                    populateBrandFilter();
                })
                .catch((error) => {
                    console.error('Error loading products:', error);
                });
        }

        // Render products in the grid
        function renderProducts(productsToRender) {
            elements.productsGrid.innerHTML = '';
            
            if (productsToRender.length === 0) {
                elements.productsGrid.innerHTML = '<p style="grid-column: 1 / -1; text-align: center;">Keine Produkte gefunden.</p>';
                return;
            }
            
            productsToRender.forEach(product => {
                const productCard = createProductCard(product);
                elements.productsGrid.appendChild(productCard);
            });
        }

        // Render featured products
        function renderFeaturedProducts() {
            elements.featuredProducts.innerHTML = '';
            
            // Get 4 random products as featured
            const featured = [...products].sort(() => 0.5 - Math.random()).slice(0, 4);
            
            featured.forEach(product => {
                const productCard = createProductCard(product);
                elements.featuredProducts.appendChild(productCard);
            });
        }

        // Create a product card element
        function createProductCard(product) {
            const card = document.createElement('div');
            card.className = 'product-card';
            card.dataset.id = product.id;
            
            // Determine if product is in wishlist or cart
            const inWishlist = wishlist.includes(product.id);
            const inCart = cart.some(item => item.id === product.id);
            
            card.innerHTML = `
                <div class="product-image" style="background-image: url('${product.images && product.images.length > 0 ? product.images[0] : 'https://via.placeholder.com/300x200?text=Kein+Bild'}')"></div>
                <div class="wishlist-icon ${inWishlist ? 'active' : ''}" data-id="${product.id}">
                    <i class="fas fa-heart"></i>
                </div>
                <div class="cart-icon ${inCart ? 'active' : ''}" data-id="${product.id}">
                    <i class="fas fa-shopping-cart"></i>
                </div>
                <div class="product-details">
                    <h3 class="product-title">${product.name}</h3>
                    <div class="product-price">${formatPrice(product.price)}</div>
                    <div class="product-specs">
                        <span>${product.brand}</span>
                        <span>${product.condition}</span>
                    </div>
                    <p>${product.description ? product.description.substring(0, 100) + '...' : ''}</p>
                    <button class="btn" style="width: 100%; margin-top: 1rem;" data-id="${product.id}">Details anzeigen</button>
                </div>
            `;
            
            // Add event listeners
            card.querySelector('.wishlist-icon').addEventListener('click', (e) => {
                e.stopPropagation();
                toggleWishlist(product.id);
            });
            
            card.querySelector('.cart-icon').addEventListener('click', (e) => {
                e.stopPropagation();
                toggleCart(product);
            });
            
            card.querySelector('button').addEventListener('click', (e) => {
                e.stopPropagation();
                showProductDetail(product);
            });
            
            card.addEventListener('click', () => {
                showProductDetail(product);
            });
            
            return card;
        }

        // Show product detail
        function showProductDetail(product) {
            // Update detail elements
            elements.detailTitle.textContent = product.name;
            elements.detailPrice.textContent = formatPrice(product.price);
            elements.detailCategory.textContent = product.category || 'Nicht angegeben';
            elements.detailBrand.textContent = product.brand || 'Nicht angegeben';
            elements.detailModel.textContent = product.model || 'Nicht angegeben';
            elements.detailCondition.textContent = product.condition || 'Nicht angegeben';
            elements.detailWarranty.textContent = product.warranty || 'Nicht angegeben';
            elements.detailDescription.textContent = product.description || 'Keine Beschreibung verfügbar.';
            
            // Update images
            elements.detailMainImage.style.backgroundImage = `url('${product.images && product.images.length > 0 ? product.images[0] : 'https://via.placeholder.com/500x400?text=Kein+Bild'}')`;
            
            elements.detailThumbnails.innerHTML = '';
            if (product.images && product.images.length > 0) {
                product.images.forEach((image, index) => {
                    const thumb = document.createElement('div');
                    thumb.className = 'thumbnail';
                    thumb.style.backgroundImage = `url('${image}')`;
                    thumb.addEventListener('click', () => {
                        elements.detailMainImage.style.backgroundImage = `url('${image}')`;
                    });
                    elements.detailThumbnails.appendChild(thumb);
                });
            }
            
            // Update button states
            const inWishlist = wishlist.includes(product.id);
            const inCart = cart.some(item => item.id === product.id);
            
            elements.detailWishlistBtn.innerHTML = inWishlist ? 'Von Wunschliste entfernen' : 'Zur Wunschliste';
            elements.detailWishlistBtn.classList.toggle('active', inWishlist);
            
            elements.detailCartBtn.innerHTML = inCart ? 'Aus Warenkorb entfernen' : 'In den Warenkorb';
            elements.detailCartBtn.classList.toggle('active', inCart);
            
            // Add event listeners
            elements.detailWishlistBtn.onclick = () => toggleWishlist(product.id);
            elements.detailCartBtn.onclick = () => toggleCart(product);
            
            // Show the detail section
            showSection('productDetail');
        }

        // Toggle product in wishlist
        function toggleWishlist(productId) {
            if (!currentUser) {
                showModal('login');
                return;
            }
            
            const index = wishlist.indexOf(productId);
            
            if (index > -1) {
                // Remove from wishlist
                wishlist.splice(index, 1);
            } else {
                // Add to wishlist
                wishlist.push(productId);
            }
            
            // Update UI
            updateWishlistIcons();
            updateHeaderCounts();
            
            // Save to localStorage
            saveLocalStorage();
            
            // If on wishlist page, update it
            if (elements.sections.wishlist.style.display === 'block') {
                renderWishlist();
            }
        }

        // Toggle product in cart
        function toggleCart(product) {
            const index = cart.findIndex(item => item.id === product.id);
            
            if (index > -1) {
                // Remove from cart
                cart.splice(index, 1);
            } else {
                // Add to cart
                cart.push({
                    id: product.id,
                    name: product.name,
                    price: product.price,
                    image: product.images && product.images.length > 0 ? product.images[0] : 'https://via.placeholder.com/100x100?text=Kein+Bild',
                    quantity: 1
                });
            }
            
            // Update UI
            updateCartIcons();
            updateHeaderCounts();
            
            // Save to localStorage
            saveLocalStorage();
            
            // If on cart page, update it
            if (elements.sections.cart.style.display === 'block') {
                renderCart();
            }
            
            // If on product detail page, update button
            if (elements.sections.productDetail.style.display === 'block') {
                const inCart = cart.some(item => item.id === product.id);
                elements.detailCartBtn.innerHTML = inCart ? 'Aus Warenkorb entfernen' : 'In den Warenkorb';
                elements.detailCartBtn.classList.toggle('active', inCart);
            }
        }

        // Render wishlist
        function renderWishlist() {
            elements.wishlistProducts.innerHTML = '';
            
            if (wishlist.length === 0) {
                elements.emptyWishlist.style.display = 'block';
                return;
            }
            
            elements.emptyWishlist.style.display = 'none';
            
            const wishlistProducts = products.filter(product => wishlist.includes(product.id));
            
            wishlistProducts.forEach(product => {
                const productCard = createProductCard(product);
                elements.wishlistProducts.appendChild(productCard);
            });
        }

        // Render cart
        function renderCart() {
            elements.cartItems.innerHTML = '';
            
            if (cart.length === 0) {
                elements.cartItems.innerHTML = '<p style="text-align: center; padding: 2rem;">Ihr Warenkorb ist leer.</p>';
                elements.cartSubtotal.textContent = '0,00 €';
                elements.cartShipping.textContent = '0,00 €';
                elements.cartTotal.textContent = '0,00 €';
                elements.checkoutBtn.disabled = true;
                return;
            }
            
            elements.checkoutBtn.disabled = false;
            
            let subtotal = 0;
            
            cart.forEach(item => {
                const itemTotal = item.price * item.quantity;
                subtotal += itemTotal;
                
                const cartItem = document.createElement('div');
                cartItem.className = 'cart-item';
                cartItem.innerHTML = `
                    <div class="cart-item-image" style="background-image: url('${item.image}')"></div>
                    <div>${item.name}</div>
                    <div>${formatPrice(item.price)}</div>
                    <div>
                        <input type="number" value="${item.quantity}" min="1" data-id="${item.id}" style="width: 60px;">
                    </div>
                    <div>${formatPrice(itemTotal)}</div>
                `;
                
                // Add event listener for quantity change
                const quantityInput = cartItem.querySelector('input');
                quantityInput.addEventListener('change', (e) => {
                    const newQuantity = parseInt(e.target.value);
                    if (newQuantity > 0) {
                        updateCartQuantity(item.id, newQuantity);
                    }
                });
                
                elements.cartItems.appendChild(cartItem);
            });
            
            const shipping = subtotal > 0 ? 4.99 : 0;
            const total = subtotal + shipping;
            
            elements.cartSubtotal.textContent = formatPrice(subtotal);
            elements.cartShipping.textContent = formatPrice(shipping);
            elements.cartTotal.textContent = formatPrice(total);
        }

        // Update cart quantity
        function updateCartQuantity(productId, quantity) {
            const item = cart.find(item => item.id === productId);
            if (item) {
                item.quantity = quantity;
                saveLocalStorage();
                renderCart();
            }
        }

        // Render checkout
        function renderCheckout() {
            elements.checkoutItems.innerHTML = '';
            
            if (cart.length === 0) {
                showSection('cart');
                return;
            }
            
            let subtotal = 0;
            
            cart.forEach(item => {
                const itemTotal = item.price * item.quantity;
                subtotal += itemTotal;
                
                const checkoutItem = document.createElement('div');
                checkoutItem.className = 'summary-item';
                checkoutItem.innerHTML = `
                    <span>${item.name} (x${item.quantity})</span>
                    <span>${formatPrice(itemTotal)}</span>
                `;
                elements.checkoutItems.appendChild(checkoutItem);
            });
            
            const shipping = subtotal > 0 ? 4.99 : 0;
            const total = subtotal + shipping;
            
            elements.checkoutSubtotal.textContent = formatPrice(subtotal);
            elements.checkoutShipping.textContent = formatPrice(shipping);
            elements.checkoutTotal.textContent = formatPrice(total);
        }

        // Handle checkout
        function handleCheckout(e) {
            e.preventDefault();
            
            if (!currentUser) {
                showModal('login');
                return;
            }
            
            elements.checkoutLoading.style.display = 'block';
            elements.checkoutError.style.display = 'none';
            
            // Create line items for Stripe
            const lineItems = cart.map(item => ({
                price_data: {
                    currency: 'eur',
                    product_data: {
                        name: item.name,
                        images: [item.image]
                    },
                    unit_amount: Math.round(item.price * 100)
                },
                quantity: item.quantity
            }));
            
            // Add shipping as a separate line item
            lineItems.push({
                price_data: {
                    currency: 'eur',
                    product_data: {
                        name: 'Standardversand'
                    },
                    unit_amount: 499 // €4.99 in cents
                },
                quantity: 1
            });
            
            // In a real implementation, you would send this to your server
            // to create a Stripe Checkout Session
            setTimeout(() => {
                elements.checkoutLoading.style.display = 'none';
                
                // Simulate successful checkout
                alert('Checkout erfolgreich! In einer echten Implementierung würden Sie zu Stripe weitergeleitet.');
                
                // Clear cart
                cart = [];
                saveLocalStorage();
                updateHeaderCounts();
                
                // Redirect to home
                showSection('home');
            }, 2000);
        }

        // Populate brand filter
        function populateBrandFilter() {
            elements.searchBrand.innerHTML = '<option value="">Alle Marken</option>';
            
            brands.sort().forEach(brand => {
                const option = document.createElement('option');
                option.value = brand;
                option.textContent = brand;
                elements.searchBrand.appendChild(option);
            });
        }

        // Apply filters
        function applyFilters() {
            const category = elements.searchCategory.value;
            const brand = elements.searchBrand.value;
            const priceMin = parseFloat(elements.searchPriceMin.value) || 0;
            const priceMax = parseFloat(elements.searchPriceMax.value) || Infinity;
            
            const filteredProducts = products.filter(product => {
                return (!category || product.category === category) &&
                       (!brand || product.brand === brand) &&
                       (product.price >= priceMin) &&
                       (product.price <= priceMax);
            });
            
            renderProducts(filteredProducts);
        }

        // Reset filters
        function resetFilters() {
            elements.searchCategory.value = '';
            elements.searchBrand.value = '';
            elements.searchPriceMin.value = '';
            elements.searchPriceMax.value = '';
            
            renderProducts(products);
        }

        // Handle login
        function handleLogin(e) {
            e.preventDefault();
            
            const email = elements.loginEmail.value;
            const password = elements.loginPassword.value;
            
            elements.loginLoading.style.display = 'block';
            elements.loginError.style.display = 'none';
            
            auth.signInWithEmailAndPassword(email, password)
                .then((userCredential) => {
                    // Signed in
                    currentUser = userCredential.user;
                    elements.loginLoading.style.display = 'none';
                    elements.loginModal.style.display = 'none';
                    
                    // Update UI
                    updateAuthUI();
                    
                    // Load user-specific data
                    loadUserData();
                })
                .catch((error) => {
                    elements.loginLoading.style.display = 'none';
                    elements.loginError.textContent = error.message;
                    elements.loginError.style.display = 'block';
                });
        }

        // Handle signup
        function handleSignup(e) {
            e.preventDefault();
            
            const name = elements.signupName.value;
            const email = elements.signupEmail.value;
            const password = elements.signupPassword.value;
            const confirm = elements.signupConfirm.value;
            
            if (password !== confirm) {
                elements.signupError.textContent = 'Passwörter stimmen nicht überein.';
                elements.signupError.style.display = 'block';
                return;
            }
            
            elements.signupLoading.style.display = 'block';
            elements.signupError.style.display = 'none';
            
            auth.createUserWithEmailAndPassword(email, password)
                .then((userCredential) => {
                    // Signed up
                    currentUser = userCredential.user;
                    
                    // Save additional user data
                    return db.collection('users').doc(currentUser.uid).set({
                        name: name,
                        email: email,
                        createdAt: firebase.firestore.FieldValue.serverTimestamp()
                    });
                })
                .then(() => {
                    elements.signupLoading.style.display = 'none';
                    elements.signupModal.style.display = 'none';
                    
                    // Update UI
                    updateAuthUI();
                })
                .catch((error) => {
                    elements.signupLoading.style.display = 'none';
                    elements.signupError.textContent = error.message;
                    elements.signupError.style.display = 'block';
                });
        }

        // Handle logout
        function handleLogout() {
            auth.signOut()
                .then(() => {
                    currentUser = null;
                    
                    // Clear user-specific data
                    wishlist = [];
                    
                    // Update UI
                    updateAuthUI();
                    
                    // Save to localStorage
                    saveLocalStorage();
                })
                .catch((error) => {
                    console.error('Error signing out:', error);
                });
        }

        // Check auth state
        function checkAuthState() {
            auth.onAuthStateChanged((user) => {
                if (user) {
                    currentUser = user;
                    
                    // Load user-specific data
                    loadUserData();
                } else {
                    currentUser = null;
                }
                
                // Update UI
                updateAuthUI();
            });
        }

        // Load user data
        function loadUserData() {
            if (!currentUser) return;
            
            // Load wishlist
            db.collection('users').doc(currentUser.uid).get()
                .then((doc) => {
                    if (doc.exists) {
                        const userData = doc.data();
                        
                        if (userData.wishlist) {
                            wishlist = userData.wishlist;
                            updateWishlistIcons();
                            updateHeaderCounts();
                        }
                        
                        // Check if user is admin
                        if (userData.isAdmin) {
                            elements.adminLink.style.display = 'block';
                        } else {
                            elements.adminLink.style.display = 'none';
                        }
                    }
                })
                .catch((error) => {
                    console.error('Error loading user data:', error);
                });
        }

        // Update authentication UI
        function updateAuthUI() {
            if (currentUser) {
                elements.loginBtn.style.display = 'none';
                elements.signupBtn.style.display = 'none';
                elements.logoutBtn.style.display = 'block';
                elements.headerWishlist.style.display = 'block';
            } else {
                elements.loginBtn.style.display = 'block';
                elements.signupBtn.style.display = 'block';
                elements.logoutBtn.style.display = 'none';
                elements.headerWishlist.style.display = 'none';
                elements.adminLink.style.display = 'none';
            }
        }

        // Update wishlist icons
        function updateWishlistIcons() {
            document.querySelectorAll('.wishlist-icon').forEach(icon => {
                const productId = icon.getAttribute('data-id');
                const inWishlist = wishlist.includes(productId);
                
                icon.classList.toggle('active', inWishlist);
            });
        }

        // Update cart icons
        function updateCartIcons() {
            document.querySelectorAll('.cart-icon').forEach(icon => {
                const productId = icon.getAttribute('data-id');
                const inCart = cart.some(item => item.id === productId);
                
                icon.classList.toggle('active', inCart);
            });
        }

        // Update header counts
        function updateHeaderCounts() {
            document.querySelector('.wishlist-count').textContent = wishlist.length;
            document.querySelector('.cart-count').textContent = cart.length;
        }

        // Handle image upload
        function handleImageUpload(e) {
            const files = e.target.files;
            
            if (!files || files.length === 0) return;
            
            elements.imagePreview.innerHTML = '';
            
            Array.from(files).forEach(file => {
                if (!file.type.match('image.*')) return;
                
                const reader = new FileReader();
                
                reader.onload = (e) => {
                    const img = document.createElement('img');
                    img.src = e.target.result;
                    img.style.width = '100px';
                    img.style.height = '100px';
                    img.style.objectFit = 'cover';
                    img.style.margin = '5px';
                    elements.imagePreview.appendChild(img);
                };
                
                reader.readAsDataURL(file);
            });
        }

        // Handle add product
        function handleAddProduct(e) {
            e.preventDefault();
            
            if (!currentUser) return;
            
            // Check if user is admin
            db.collection('users').doc(currentUser.uid).get()
                .then((doc) => {
                    if (doc.exists && doc.data().isAdmin) {
                        // User is admin, proceed with adding product
                        const name = elements.productName.value;
                        const description = elements.productDescription.value;
                        const price = parseFloat(elements.productPrice.value);
                        const category = elements.productCategory.value;
                        const brand = elements.productBrand.value;
                        const model = elements.productModel.value;
                        const condition = elements.productCondition.value;
                        const warranty = elements.productWarranty.value;
                        
                        elements.addProductLoading.style.display = 'block';
                        elements.addProductMessage.style.display = 'none';
                        
                        // In a real implementation, you would upload images to Firebase Storage
                        // and then save the product data to Firestore
                        
                        setTimeout(() => {
                            elements.addProductLoading.style.display = 'none';
                            elements.addProductMessage.textContent = 'Produkt erfolgreich hinzugefügt!';
                            elements.addProductMessage.className = 'success-message';
                            elements.addProductMessage.style.display = 'block';
                            
                            // Reset form
                            elements.addProductForm.reset();
                            elements.imagePreview.innerHTML = '';
                            
                            // Reload products
                            loadProducts();
                        }, 2000);
                    } else {
                        // User is not admin
                        elements.addProductMessage.textContent = 'Nur Administratoren können Produkte hinzufügen.';
                        elements.addProductMessage.className = 'error-message';
                        elements.addProductMessage.style.display = 'block';
                    }
                })
                .catch((error) => {
                    console.error('Error checking admin status:', error);
                });
        }

        // Render admin products
        function renderAdminProducts() {
            elements.adminProductsList.innerHTML = '';
            
            products.forEach(product => {
                const productItem = document.createElement('div');
                productItem.className = 'product-item';
                productItem.style.marginBottom = '1rem';
                productItem.style.padding = '1rem';
                productItem.style.backgroundColor = 'white';
                productItem.style.borderRadius = '4px';
                
                productItem.innerHTML = `
                    <h4>${product.name}</h4>
                    <p>${formatPrice(product.price)} | ${product.category} | ${product.brand}</p>
                    <button class="btn" style="margin-right: 0.5rem;">Bearbeiten</button>
                    <button class="btn" style="background-color: #f44336;">Löschen</button>
                `;
                
                elements.adminProductsList.appendChild(productItem);
            });
        }

        // Handle contact form
        function handleContact(e) {
            e.preventDefault();
            
            const name = elements.contactName.value;
            const email = elements.contactEmail.value;
            const message = elements.contactMessage.value;
            
            // In a real implementation, you would send this data to a server
            // or save it to a database
            
            alert('Nachricht wurde gesendet! Vielen Dank für Ihre Kontaktaufnahme.');
            elements.contactForm.reset();
        }

        // Load from localStorage
        function loadLocalStorage() {
            const savedCart = localStorage.getItem('tech_zentrale_cart');
            const savedWishlist = localStorage.getItem('tech_zentrale_wishlist');
            
            if (savedCart) {
                cart = JSON.parse(savedCart);
            }
            
            if (savedWishlist && !currentUser) {
                // Only load wishlist from localStorage if user is not logged in
                // If user is logged in, wishlist is loaded from Firestore
                wishlist = JSON.parse(savedWishlist);
            }
        }

        // Save to localStorage
        function saveLocalStorage() {
            localStorage.setItem('tech_zentrale_cart', JSON.stringify(cart));
            
            if (!currentUser) {
                // Only save wishlist to localStorage if user is not logged in
                // If user is logged in, wishlist is saved to Firestore
                localStorage.setItem('tech_zentrale_wishlist', JSON.stringify(wishlist));
            } else if (currentUser) {
                // Save wishlist to Firestore for logged in users
                db.collection('users').doc(currentUser.uid).update({
                    wishlist: wishlist
                }).catch((error) => {
                    console.error('Error saving wishlist:', error);
                });
            }
        }

        // Format price
        function formatPrice(price) {
            return new Intl.NumberFormat('de-DE', { style: 'currency', currency: 'EUR' }).format(price);
        }

        // Initialize the app
        init();
    </script>
</body>
</html>